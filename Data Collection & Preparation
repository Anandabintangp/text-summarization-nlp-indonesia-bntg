# Import Libraries
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import re
import torch
import os
import json
from tqdm.notebook import tqdm
from transformers import (
    AutoModel,
    AutoTokenizer,
    BertTokenizer,
    pipeline,
    LineByLineTextDataset,
    EncoderDecoderModel,
    BertConfig,
    BertForMaskedLM,
    DataCollatorForLanguageModeling,
    Trainer,
    TrainingArguments
)
import nltk
from nltk.corpus import stopwords

# Mengunduh paket NLTK (jika belum ada)
try:
    nltk.download('stopwords')
    nltk.download('punkt')
    nltk.download('punkt_tab')
except:
    # Beberapa paket mungkin tidak tersedia atau sudah terunduh
    pass

tqdm.pandas()

# Cek device CUDA
device = 0 if torch.cuda.is_available() else -1
print(f"Menggunakan device: {device} ({torch.cuda.get_device_name(0) if device >= 0 else 'CPU'})")

# --- Fungsi untuk Parsing Data JSON ke DataFrame ---

# Ganti path ini sesuai dengan lokasi folder dataset Anda!
# Struktur dataset diasumsikan: parent_folder/canonical/train/....json
base_data_path = r"D:\path_ke_folder_dataset_liputan6" # Ganti dengan path Anda
train_dir = os.path.join(base_data_path, "canonical", "train")
validate_dir = os.path.join(base_data_path, "canonical", "dev")
test_dir = os.path.join(base_data_path, "canonical", "test")

def parsing_folder(folder):
    """
    Fungsi untuk membaca semua file JSON di dalam folder
    dan memuatnya ke dalam Pandas DataFrame.
    """
    data = [] # list untuk menampung data JSON
    print(f"Sedang memproses folder: {folder}")

    # Looping proses parsing
    for file_name in os.listdir(folder):
        if file_name.endswith(".json"):
            file_path = os.path.join(folder, file_name)
            try:
                with open(file_path, "r", encoding="utf-8") as f:
                    data.append(json.load(f))
            except Exception as e:
                print(f"Error parsing {file_name} di {folder}: {e}")
    
    return pd.DataFrame(data)

# Memuat data
try:
    df_train = parsing_folder(train_dir)
    df_validate = parsing_folder(validate_dir)
    df_test = parsing_folder(test_dir)
    print("\nData berhasil dimuat!")
except FileNotFoundError as e:
    print(f"\nERROR: Pastikan path folder dataset sudah benar: {e}")
